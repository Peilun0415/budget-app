<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>我的記帳本</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- 登入畫面 -->
  <div class="login-screen" id="loginScreen">
    <div class="login-card">
      <div class="login-logo">💳</div>
      <h1 class="login-title">我的記帳本</h1>
      <p class="login-desc">登入後可在手機與電腦<br>同步查看所有記帳資料</p>
      <button class="google-login-btn" id="googleLoginBtn">
        <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.08 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-3.59-13.46-8.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
        使用 Google 帳號登入
      </button>
    </div>
  </div>

  <!-- 主應用（登入後顯示） -->
  <div class="app-screen" id="appScreen" style="display:none">

    <!-- 頂部標題 -->
    <header class="app-header">
      <div class="header-title">
        <h1 id="pageTitle">我的記帳本</h1>
      </div>
      <div class="header-right">
        <img class="user-avatar" id="userAvatar" src="" alt="" />
        <button class="logout-btn" id="logoutBtn">登出</button>
      </div>
    </header>

    <!-- ===== 記帳頁面 ===== -->
    <div id="pageHome">
      <!-- 月份導覽 -->
      <div class="month-nav-bar">
        <button class="month-btn" id="prevMonth">‹</button>
        <span id="currentMonthLabel"></span>
        <button class="month-btn" id="nextMonth">›</button>
      </div>

      <!-- 統計卡片 -->
      <section class="summary-section">
        <div class="summary-card income-card">
          <div class="summary-icon">💰</div>
          <div class="summary-info">
            <span class="summary-label">本月收入</span>
            <span class="summary-amount" id="totalIncome">$0</span>
          </div>
        </div>
        <div class="summary-card expense-card">
          <div class="summary-icon">🛍️</div>
          <div class="summary-info">
            <span class="summary-label">本月支出</span>
            <span class="summary-amount" id="totalExpense">$0</span>
          </div>
        </div>
        <div class="summary-card balance-card">
          <div class="summary-icon">✨</div>
          <div class="summary-info">
            <span class="summary-label">結餘</span>
            <span class="summary-amount" id="totalBalance">$0</span>
          </div>
        </div>
      </section>

      <!-- 新增按鈕 -->
      <div class="add-btn-wrap">
        <button class="add-btn" id="openFormBtn">＋ 新增記帳</button>
      </div>

      <!-- 記帳列表 -->
      <section class="list-section">
        <h2 class="list-title">本月明細</h2>
        <div id="recordList" class="record-list">
          <div class="empty-state" id="emptyState">
            <span>📋</span>
            <p>還沒有記帳喔！<br>點上方按鈕開始記帳吧～</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ===== 帳戶頁面 ===== -->
    <div id="pageAccounts" style="display:none">
      <div class="accounts-header-bar">
        <div class="accounts-net-worth">
          <span class="accounts-net-label">淨資產</span>
          <span class="accounts-net-amount" id="accountsNetWorth">$0</span>
        </div>
        <div class="accounts-sub-stats">
          <div class="accounts-sub-item">
            <span class="accounts-sub-label">資產</span>
            <span class="accounts-sub-value asset" id="accountsTotalAsset">$0</span>
          </div>
          <div class="accounts-sub-divider"></div>
          <div class="accounts-sub-item">
            <span class="accounts-sub-label">負債</span>
            <span class="accounts-sub-value liability" id="accountsTotalLiability">$0</span>
          </div>
        </div>
      </div>

      <div class="add-btn-wrap">
        <button class="add-btn" id="openAccountFormBtn">＋ 新增帳戶</button>
      </div>

      <section class="list-section">
        <div id="accountList" class="account-list">
          <div class="empty-state" id="accountEmptyState">
            <span>🏦</span>
            <p>還沒有帳戶喔！<br>點上方按鈕新增帳戶吧～</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ===== 帳戶明細頁面 ===== -->
    <div id="pageAccountDetail" style="display:none">
      <!-- 帳戶資訊卡 -->
      <div class="account-detail-header">
        <button class="back-btn" id="backToAccountsBtn">‹ 返回</button>
        <div class="account-detail-info">
          <div class="account-detail-icon" id="detailIcon"></div>
          <div>
            <div class="account-detail-name" id="detailName"></div>
            <div class="account-detail-type" id="detailType"></div>
          </div>
        </div>
        <div class="account-detail-stats">
          <div class="detail-stat">
            <span class="detail-stat-label">期間收入</span>
            <span class="detail-stat-value income" id="detailIncome">$0</span>
          </div>
          <div class="detail-stat">
            <span class="detail-stat-label">期間支出</span>
            <span class="detail-stat-value expense" id="detailExpense">$0</span>
          </div>
          <div class="detail-stat detail-stat-balance">
            <span class="detail-stat-label">目前餘額</span>
            <span class="detail-stat-value balance" id="detailBalance">$0</span>
          </div>
        </div>
      </div>

      <!-- 時間範圍切換 -->
      <div class="detail-filter-bar">
        <div class="detail-mode-toggle">
          <button class="detail-mode-btn active" id="detailModeMonth">月份</button>
          <button class="detail-mode-btn" id="detailModeRange">自訂範圍</button>
          <button class="detail-mode-btn" id="detailModeAll">全部</button>
        </div>

        <!-- 月份模式 -->
        <div class="detail-month-nav" id="detailMonthNav">
          <button class="month-btn" id="detailPrevMonth">‹</button>
          <span id="detailMonthLabel"></span>
          <button class="month-btn" id="detailNextMonth">›</button>
        </div>

        <!-- 自訂範圍模式 -->
        <div class="detail-range-nav" id="detailRangeNav" style="display:none">
          <div class="range-row">
            <label>從</label>
            <input type="date" id="detailRangeStart" class="range-date-input" />
          </div>
          <div class="range-row">
            <label>到</label>
            <input type="date" id="detailRangeEnd" class="range-date-input" />
          </div>
        </div>
      </div>

      <!-- 明細列表 -->
      <section class="list-section">
        <h2 class="list-title" id="detailListTitle">本月明細</h2>
        <div id="accountDetailList" class="record-list">
          <div class="empty-state" id="accountDetailEmpty">
            <span>📋</span>
            <p>這個期間沒有記帳記錄</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ===== 分類管理頁面 ===== -->
    <div id="pageCategories" style="display:none">
      <div class="cat-mgmt-tabs">
        <button class="cat-mgmt-tab active" id="catTabExpense" data-type="expense">
          <span>💸</span> 支出
        </button>
        <button class="cat-mgmt-tab" id="catTabIncome" data-type="income">
          <span>💰</span> 收入
        </button>
      </div>
      <div class="add-btn-wrap">
        <button class="add-btn" id="openCatFormBtn">＋ 新增主分類</button>
      </div>
      <section class="list-section">
        <div id="categoryMgmtList" class="category-mgmt-list"></div>
      </section>
    </div>

    <!-- 底部導覽列 -->
    <nav class="bottom-nav">
      <button class="nav-btn active" id="navHome" data-page="home">
        <span class="nav-icon">📒</span>
        <span class="nav-label">記帳</span>
      </button>
      <button class="nav-btn" id="navAccounts" data-page="accounts">
        <span class="nav-icon">🏦</span>
        <span class="nav-label">帳戶</span>
      </button>
      <button class="nav-btn" id="navCategories" data-page="categories">
        <span class="nav-icon">🏷️</span>
        <span class="nav-label">分類</span>
      </button>
    </nav>

  </div><!-- /app-screen -->

  <!-- 新增/編輯記帳彈窗 -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h2 id="recordModalTitle">新增記帳</h2>
        <button class="close-btn" id="closeFormBtn">✕</button>
      </div>

      <div class="type-toggle">
        <button class="type-btn active" id="btnExpense" data-type="expense">支出</button>
        <button class="type-btn" id="btnIncome" data-type="income">收入</button>
      </div>

      <form id="recordForm">
        <div class="form-group">
          <label for="amount">金額</label>
          <div class="amount-row">
            <button type="button" class="cat-pick-btn" id="catPickBtn">
              <span id="catPickEmoji">📦</span>
              <span id="catPickName">選擇分類</span>
            </button>
            <div class="amount-input-wrap" id="amountInputWrap">
              <span class="currency-sign">$</span>
              <input type="text" id="amount" placeholder="0" inputmode="none" required />
              <button type="button" class="calc-toggle-btn" id="calcToggleBtn">🔢</button>
            </div>
          </div>
          <!-- 計算機顯示列 -->
          <div class="calc-expression" id="calcExpression"></div>
          <!-- 計算機鍵盤 -->
          <div class="calc-keyboard" id="calcKeyboard" style="display:none">
            <div class="calc-grid">
              <button type="button" class="calc-btn calc-fn" data-action="clear">C</button>
              <button type="button" class="calc-btn calc-fn" data-action="backspace">⌫</button>
              <button type="button" class="calc-btn calc-op" data-val="%">%</button>
              <button type="button" class="calc-btn calc-op" data-val="÷">÷</button>

              <button type="button" class="calc-btn" data-val="7">7</button>
              <button type="button" class="calc-btn" data-val="8">8</button>
              <button type="button" class="calc-btn" data-val="9">9</button>
              <button type="button" class="calc-btn calc-op" data-val="×">×</button>

              <button type="button" class="calc-btn" data-val="4">4</button>
              <button type="button" class="calc-btn" data-val="5">5</button>
              <button type="button" class="calc-btn" data-val="6">6</button>
              <button type="button" class="calc-btn calc-op" data-val="-">−</button>

              <button type="button" class="calc-btn" data-val="1">1</button>
              <button type="button" class="calc-btn" data-val="2">2</button>
              <button type="button" class="calc-btn" data-val="3">3</button>
              <button type="button" class="calc-btn calc-op" data-val="+">+</button>

              <button type="button" class="calc-btn" data-val="0">0</button>
              <button type="button" class="calc-btn" data-val=".">.</button>
              <button type="button" class="calc-btn calc-eq" data-action="equal" colspan="2">=</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="date">日期</label>
          <input type="date" id="date" required />
        </div>

        <!-- 帳戶選擇 -->
        <div class="form-group">
          <label for="accountSelect">帳戶</label>
          <select id="accountSelect" class="form-select">
          </select>
        </div>

        <div class="form-group">
          <label for="note">備註（選填）</label>
          <input type="text" id="note" placeholder="例：午餐、薪水..." maxlength="30" />
        </div>

        <input type="hidden" id="recordEditId" value="" />
        <div class="form-action-row">
          <button type="submit" class="submit-btn" id="submitBtn">記下來！</button>
          <button type="button" class="delete-record-btn" id="deleteRecordBtn" style="display:none">刪除</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 分類選擇彈窗 -->
  <div class="modal-overlay cat-picker-overlay" id="catPickerOverlay">
    <div class="modal cat-picker-modal">
      <div class="modal-header">
        <h2>選擇分類</h2>
        <button class="close-btn" id="closeCatPickerBtn">✕</button>
      </div>
      <div class="cat-picker-body">
        <div class="cat-picker-left" id="catPickerParents"></div>
        <div class="cat-picker-right" id="catPickerSubs"></div>
      </div>
    </div>
  </div>

  <!-- 新增帳戶彈窗 -->
  <div class="modal-overlay" id="accountModalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h2 id="accountModalTitle">新增帳戶</h2>
        <button class="close-btn" id="closeAccountFormBtn">✕</button>
      </div>

      <form id="accountForm">
        <!-- 帳戶類型 -->
        <div class="form-group">
          <label>帳戶類型</label>
          <div class="account-type-grid" id="accountTypeGrid"></div>
        </div>

        <!-- 帳戶名稱 -->
        <div class="form-group">
          <label for="accountName">帳戶名稱</label>
          <input type="text" id="accountName" placeholder="例：玉山銀行、國泰世華..." maxlength="20" required />
        </div>

        <!-- 初始餘額 -->
        <div class="form-group">
          <label for="accountBalance">初始餘額（信用卡欠款請輸入負數，例：-5000）</label>
          <div class="amount-input-wrap">
            <span class="currency-sign">$</span>
            <input type="number" id="accountBalance" placeholder="0" inputmode="decimal" />
          </div>
        </div>

        <!-- 備註 -->
        <div class="form-group">
          <label for="accountNote">備註（選填）</label>
          <input type="text" id="accountNote" placeholder="例：主要薪轉帳戶..." maxlength="30" />
        </div>

        <input type="hidden" id="accountEditId" value="" />
        <button type="submit" class="submit-btn" id="accountSubmitBtn">儲存帳戶</button>
      </form>
    </div>
  </div>

  <!-- 分類編輯彈窗（主分類 / 子分類共用） -->
  <div class="modal-overlay" id="catModalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h2 id="catModalTitle">新增主分類</h2>
        <button class="close-btn" id="closeCatFormBtn">✕</button>
      </div>
      <form id="catForm">
        <div class="form-group">
          <label>圖示（Emoji）</label>
          <input type="text" id="catEmoji" placeholder="例：🍜" maxlength="4" />
        </div>
        <div class="form-group">
          <label for="catName">名稱</label>
          <input type="text" id="catName" placeholder="例：飲食" maxlength="12" required />
        </div>
        <!-- 子分類時顯示：所屬主分類（唯讀） -->
        <div class="form-group" id="catParentGroup" style="display:none">
          <label>所屬主分類</label>
          <div id="catParentLabel" class="cat-parent-label"></div>
        </div>
        <input type="hidden" id="catEditId" value="" />
        <input type="hidden" id="catParentId" value="" />
        <input type="hidden" id="catIsParent" value="true" />
        <div class="form-action-row">
          <button type="submit" class="submit-btn" id="catSubmitBtn">儲存</button>
          <button type="button" class="delete-record-btn" id="deleteCatBtn" style="display:none">刪除</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
